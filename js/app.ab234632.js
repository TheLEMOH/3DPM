(function(t){function e(e){for(var r,o,u=e[0],l=e[1],c=e[2],p=0,f=[];p<u.length;p++)o=u[p],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(t[r]=l[r]);s&&s(e);while(f.length)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,u=1;u<n.length;u++){var l=n[u];0!==a[l]&&(r=!1)}r&&(i.splice(e--,1),t=o(o.s=n[0]))}return t}var r={},a={app:0},i=[];function o(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=r,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="./";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],l=u.push.bind(u);u.push=e,u=u.slice();for(var c=0;c<u.length;c++)e(u[c]);var s=l;i.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t._v(" "+t._s(t.text)+" "),n("Settings",{on:{ref:t.Refresh}}),n("div",{staticStyle:{display:"inline"}},[t.load?n("Topo",{attrs:{data:t.data3D}}):t._e(),n("hr"),t.load?n("Surface",{attrs:{data:t.surfaceData}}):t._e()],1)],1)},i=[],o=(n("159b"),n("d81d"),n("d3b7"),n("ddb0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Plotly",{attrs:{data:t.data,layout:t.layout,config:t.config,"display-mode-bar":!1}})}),u=[],l=n("04d1"),c={components:{Plotly:l["Plotly"]},props:["data"],data:function(){return{config:{responsive:!0},layout:{height:1e3,scene:{xaxis:{title:"Направление (x)"},yaxis:{title:"Скорость (y)"},zaxis:{title:"Pm (z)"}}}}}},s=c,p=n("2877"),f=Object(p["a"])(s,o,u,!1,null,null,null),v=f.exports,h=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("Plotly",{attrs:{data:t.data,layout:t.layout,config:t.config,"display-mode-bar":!1}})},d=[],m={components:{Plotly:l["Plotly"]},props:["data"],data:function(){return{config:{responsive:!0},layout:{height:700}}}},g=m,y=Object(p["a"])(g,h,d,!1,null,null,null),b=y.exports,x=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"settings"},[n("form",[n("label",{staticClass:"block"},[t._v("Дата")]),n("date-picker",{staticClass:"block",attrs:{range:"",valueType:"format"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1),n("form",[n("label",{staticClass:"block"},[t._v("Агрегирование")]),n("select",{directives:[{name:"model",rawName:"v-model",value:t.interval,expression:"interval"}],staticClass:"block",staticStyle:{height:"34px","font-size":"14px"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.interval=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"1hour"}},[t._v("Час")]),n("option",{attrs:{value:"6hour"}},[t._v("6 часов")]),n("option",{attrs:{value:"12hour"}},[t._v("12 часов")]),n("option",{attrs:{value:"1day"}},[t._v("День")])])]),n("form",{staticStyle:{display:"none"}},[n("label",{staticClass:"block"},[t._v("Тип графика")]),n("select",{directives:[{name:"model",rawName:"v-model",value:t.type,expression:"type"}],staticClass:"block",staticStyle:{height:"34px","font-size":"14px"},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.type=e.target.multiple?n:n[0]}}},[n("option",{attrs:{value:"mesh3d"}},[t._v("Mesh")]),n("option",{attrs:{value:"scatter3d"}},[t._v("Scatter")]),n("option",{attrs:{value:"surface"}},[t._v("Surface")])])]),n("button",{staticStyle:{height:"34px"},on:{click:t.Refresh}},[t._v("Обновить")])])},_=[],w=n("ec45"),k=(n("411c"),{components:{DatePicker:w["a"]},data:function(){return{time:["2019-06-01","2019-06-08"],interval:"6hour",type:"scatter3d"}},methods:{Refresh:function(){this.$emit("ref",this.time,this.interval,this.type)}}}),O=k,j=Object(p["a"])(O,x,_,!1,null,null,null),S=j.exports,P=n("1da1");n("96cf"),n("4de4"),n("c740"),n("a9e3"),n("99af"),n("b680");function N(t,e){return T.apply(this,arguments)}function T(){return T=Object(P["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/9/aggvalues?&sites=3837&key=654hblgm9gl8367h&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[1]," 00:00:00&time_interval=").concat(n,"&indicators=348&limit=30000'"),a=fetch(r),i=a.then((function(t){return z(t)})),t.abrupt("return",i);case 4:case"end":return t.stop()}}),t)}))),T.apply(this,arguments)}function E(t,e){return M.apply(this,arguments)}function M(){return M=Object(P["a"])(regeneratorRuntime.mark((function t(e,n){var r,a,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="https://gis.krasn.ru/sc/api/1.0/projects/10/aggvalues?&sites=4226&key=654hblgm9gl8367h&time_begin=".concat(e[0]," 00:00:00&time_end=").concat(e[1]," 00:00:00&time_interval=").concat(n,"&indicators=101,102&limit=30000'"),a=fetch(r),i=a.then((function(t){return z(t)})),t.abrupt("return",i);case 4:case"end":return t.stop()}}),t)}))),M.apply(this,arguments)}function R(t){return t>=0&&t<11.25?0:t>=11.25&&t<33.75?1:t>=33.75&&t<56.25?2:t>=56.25&&t<78.75?3:t>=78.75&&t<101.25?4:t>=101.25&&t<123.75?5:t>=123.75&&t<146.25?6:t>=146.25&&t<168.75?7:t>=168.75&&t<191.25?8:t>=191.25&&t<213.75?9:t>=213.75&&t<236.25?10:t>=236.25&&t<258.75?11:t>=258.75&&t<281.25?12:t>=281.25&&t<303.75?13:t>=303.75&&t<326.25?14:t>=326.25&&t<348.75?15:t>=348.75?0:void 0}function z(t){return D.apply(this,arguments)}function D(){return D=Object(P["a"])(regeneratorRuntime.mark((function t(e){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.text().then((function(t){var e=[],n=new DOMParser,r=n.parseFromString(t,"text/xml"),a=r.getElementsByTagName("aggvalue"),i=0;return a.forEach((function(t){var n=t.getAttribute("indicator"),r=t.getAttribute("time").substring(0,t.getAttribute("time").length-3),a="NONE";101==n&&(a=R(Number(t.getElementsByTagName("avg")[0].innerHTML)),i++),348==n&&(a=Number(1e3*t.getElementsByTagName("avg")[0].innerHTML).toFixed(4)),102==n&&(a=Number(t.getElementsByTagName("avg")[0].innerHTML).toFixed(1)),e.push({indicator:n,time:r,value:a,index:i-1})})),e})),t.abrupt("return",n);case 2:case"end":return t.stop()}}),t)}))),D.apply(this,arguments)}function C(t,e){var n=t.filter((function(t){if(t.indicator==e)return t}));return n}function A(t){try{var e=t.map((function(t){return t.time})),n=t.map((function(t){return t.value}));return{times:e,values:n}}catch(r){return alert("Выберите другую дату или другое агрегирование"),[]}}function $(t,e,n){for(var r=["С","ССВ","СВ","ВСВ","В","ВЮВ","ЮВ","ЮЮВ","Ю","ЮЮЗ","ЮЗ","ЗЮЗ","З","ЗСЗ","СЗ","ССЗ"],a=[],i=0;i<12;i++){for(var o=[],u=0;u<r.length;u++)o.push(0);a.push(o)}return console.log(a),console.log(t,e,n),t.forEach((function(t,i){var o=r.findIndex((function(e){return t==e}));a[Math.round(Number(e[i]))][o]<Number(n[i])&&(a[Math.round(Number(e[i]))][o]=n[i])})),a}var B={name:"App",data:function(){return{data3D:"",surfaceData:"",load:!1,text:""}},components:{Settings:S,Topo:v,Surface:b},methods:{Refresh:function(t,e,n){var r=this;this.text="ЗАГРУЗКА...",N(t,e).then((function(a){E(t,e).then((function(t){var e=C(t,101),i=C(t,102),o=C(a,348);e.sort((function(t,e){return t.value>e.value?1:t.value<e.value?-1:0}));var u=[],l=[],c=["С","ССВ","СВ","ВСВ","В","ВЮВ","ЮВ","ЮЮВ","Ю","ЮЮЗ","ЮЗ","ЗЮЗ","З","ЗСЗ","СЗ","ССЗ"];e.forEach((function(t){u.push(i[t.index]),l.push(o[t.index])}));var s=e.map((function(t){return t.value=c[t.value],t})),p=A(s).values,f=A(u).values,v=A(l).values;r.data3D=[{opacity:1,color:"rgb(100,100,200)",type:n,mode:"markers",marker:{size:8,symbol:"circle",opacity:.7},x:p,y:f,z:v}];var h=c,d=[0,1,2,3,4,5,6,7,8,9,10,11],m=$(p,f,v);console.log(m),r.surfaceData=[{opacity:.9,type:"surface",x:h,y:d,z:m,contours:{x:{highlight:!0,highlightcolor:"#41a7b3"},y:{highlight:!1},z:{highlight:!1}}}],r.text="ГОТОВО",r.load=!0}))}))}},mounted:function(){this.Refresh(["2019-06-01","2019-06-08"],"6hour","scatter3d")}},F=B,H=(n("034f"),Object(p["a"])(F,a,i,!1,null,null,null)),L=H.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(t){return t(L)}}).$mount("#app")},"85ec":function(t,e,n){}});
//# sourceMappingURL=app.ab234632.js.map